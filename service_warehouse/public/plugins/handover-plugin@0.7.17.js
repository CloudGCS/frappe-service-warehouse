/*! For license information please see handover-plugin@0.7.17-staging.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("antd"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define([,,],t):"object"==typeof exports?exports["handover-plugin"]=t(require("antd"),require("react"),require("react-dom")):e["handover-plugin"]=t(e.Antd,e.React,e.ReactDOM)}(self,((e,t,r)=>(()=>{"use strict";var n={745:(e,t,r)=>{var n=r(238);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},251:(e,t,r)=>{var n=r(868),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var n,o={},l=null,c=null;for(n in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,n)&&!d.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:s,type:e,key:l,ref:c,props:o,_owner:a.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},893:(e,t,r)=>{e.exports=r(251)},423:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAircraftName=t.getUserName=void 0;const n=r(893),s=r(868),o=r(505),i=r(993),a=r(147);let d=null,l=2e4;t.getUserName=e=>e?e.split("-")[0]:"",t.getAircraftName=(e,t)=>null==t?void 0:t.replace(`${e}-`,""),t.default=({pluginApi:e})=>{const[r,c]=(0,s.useState)(!1),[u,f]=(0,s.useState)([]),[p,v]=(0,s.useState)(""),[m,g]=(0,s.useState)(0),A=(0,s.useRef)(null),y=r=>{var n;const s=r[0],i=`${null==s?void 0:s.aircraftName}`,a=(0,t.getAircraftName)(null==s?void 0:s.tenantCode,i);if(clearTimeout(d),d=null,s.data.answer)"Request"===(null==s?void 0:s.data.handOverCommandType)?o.notification.success({message:`Your handover request is accepted. ${a} is under your control.`}):"Offer"===(null==s?void 0:s.data.handOverCommandType)&&o.notification.success({message:`Your handover request is accepted. ${(0,t.getUserName)(null===(n=r[0])||void 0===n?void 0:n.userName)} took control of ${a}.`});else{let r=e.systemApi.selectedAircraftApi.isBeingControlled()?`${(0,t.getUserName)(s.userCode)} rejected handover offer.`:`${(0,t.getUserName)(s.userCode)} rejected handover request.`;o.notification.error({message:r})}},b=r=>{const n=r[0],s=`${null==n?void 0:n.aircraftName}`,i=(0,t.getAircraftName)(n.tenantCode,s),a=(0,t.getUserName)(null==n?void 0:n.userName);let d=!1;const c=o.Modal.confirm({title:"HandOver Request",icon:"",content:"Offer"===n.data.handOverCommandType?`A handover offer for ${i} is received from ${a}. Do you accept it?`:`A handover request for ${i} is received from ${a}. Do you accept it?`,onOk:()=>{d=!0,e.systemApi.handoverApi.sendHandOverResponse(!0,n);let t=0;const r=setInterval((()=>{const d=((t,r)=>!!e.systemApi.userApi.getActiveUsers().find((e=>e.userCode===t&&e.listOfControllingAircrafts.find((e=>e.aircraftName===r)))))(null==n?void 0:n.userName,s);return d?(clearInterval(r),void o.notification.success({message:"Offer"===n.data.handOverCommandType?`${i} is under your control.`:`${a} took control of ${i}.`})):(t++,t>20?(o.notification.error({message:`There is an error! ${a} can not take control of ${i}.`}),void clearInterval(r)):void 0)}),500)},onCancel:()=>{d=!0,e.systemApi.handoverApi.sendHandOverResponse(!1,n)},okText:"Accept",cancelText:"Reject"});setTimeout((()=>{d||c.destroy()}),l)},h=e=>{g((new Date).getTime())},O=t=>{var r;if(t.length>0){const n=t[0];if(n.length>0){const t=null===(r=e.systemApi.selectedAircraftApi.getAircraftIdentifier())||void 0===r?void 0:r.aircraftId,s=n.filter((e=>!!e.listOfObservingAircrafts.find((e=>e.aircraftId===t))&&e.isPilot));f(s)}else f([])}else f([])},C=(t,r,n)=>{e.pluginUIManager.setDisabledSubMenuItem(t,"request",r),e.pluginUIManager.setDisabledSubMenuItem(t,"offer",n)};return(0,s.useEffect)((()=>{const t=e.pluginUIManager.addMenuItem({key:"handoverMenu",label:"HandOver",onClick:()=>{},disabled:!1,children:[{key:"request",label:"Request Control",onClick:()=>{var t;e.systemApi.handoverApi.requestHandOver(null===(t=e.systemApi.selectedAircraftApi.getAircraftIdentifier())||void 0===t?void 0:t.aircraftId),d=setTimeout((()=>{d&&o.notification.error({message:"No response is received."})}),l)},disabled:!0},{key:"offer",label:"Offer Control",onClick:()=>{c(!0)},disabled:!0}]});v(t)}),[]),(0,s.useEffect)((()=>(A.current&&clearInterval(A.current),A.current=setInterval((()=>{(()=>{if(!p)return;const t=e.systemApi.selectedAircraftApi.getAircraftIdentifier(),r=e.systemApi.userApi.getUserInfo();if(t){const s=e.systemApi.selectedAircraftApi.isBeingControlled();if(e.pluginUIManager.setDisabledMenuItem(p,!1),s)C(p,!0,(n=t.aircraftId,!e.systemApi.userApi.getActiveUsers().some((e=>!!e.listOfObservingAircrafts.find((e=>e.aircraftId===n))))));else{let n=!0;e.systemApi.userApi.getActiveUsers().find((e=>e.listOfControllingAircrafts.find((e=>e.aircraftId===t.aircraftId))))&&r.isPilot&&(n=!1),C(p,n,!0)}}var n})()}),1e3),()=>{clearInterval(A.current)})),[p,m]),(0,s.useEffect)((()=>{const t=e.systemApi.userApi.getActiveUsers().filter((e=>e.isPilot));return f(t),e.eventListener.onReceivedHandOverCommand(b),e.eventListener.onActiveAircraftChanged(h),e.eventListener.onReceivedHandOverResponse(y),e.eventListener.onOnlineUsersCode(O),e.eventListener.onLogout({pluginName:a.libraryName,callback:()=>(c(!1),!0),message:`${a.libraryName} is logging out.`}),()=>{e.eventListener.removeReceivedHandOverCommand(b),e.eventListener.removeActiveAircraftChanged(h),e.eventListener.removeReceivedHandOverResponse(y),e.eventListener.removeOnlineUsersCode(O)}}),[]),(0,n.jsx)("div",{children:(0,n.jsx)(i.default,{users:u,show:r,onSelect:t=>{t&&t.userCode&&(t=>{var r;const n=null===(r=e.systemApi.selectedAircraftApi.getAircraftIdentifier())||void 0===r?void 0:r.aircraftId;t&&n&&(e.systemApi.handoverApi.handOver(n,t.userCode),d=setTimeout((()=>{d&&o.notification.error({message:"No response is received."})}),l))})(t),c(!1)},onCancel:()=>{c(!1)}})})}},993:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(893),s=r(868),o=r(505),i=r(423);t.default=function({users:e,show:t,onSelect:r,onCancel:a}){const[d,l]=(0,s.useState)({});return(0,s.useEffect)((()=>{e&&e.length>0&&l(e[0])}),[e]),(0,n.jsx)(o.Modal,Object.assign({title:"Select User",open:t,onOk:()=>r&&r(d),onCancel:()=>a&&a()},{children:e.length>0?(0,n.jsx)("select",Object.assign({id:"user-select",value:d.userCode,style:{height:32,width:300},placeholder:"Select User",onChange:t=>{l(e.find((e=>e.userCode===t.target.value)))}},{children:e.map(((e,t)=>(0,n.jsx)("option",Object.assign({value:e.userCode,label:(0,i.getUserName)(e.userCode)},{children:(0,i.getUserName)(e.userCode)}),t)))})):(0,n.jsx)("p",{children:"User Not Found"})}))}},505:t=>{t.exports=e},868:e=>{e.exports=t},238:e=>{e.exports=r},147:e=>{e.exports=JSON.parse('{"name":"handover-plugin","libraryName":"Handover Plugin","version":"0.7.17-staging","config":{"isUseMenu":true},"scripts":{"main-build":"npx webpack  --mode production --env ENV=production ","staging-build":"npx webpack  --mode production --env ENV=production ","development-build":"npx webpack --mode development  --env  ENV=development","local-build":"npx webpack  --mode development   --env  ENV=local  && xcopy /E /I /Y .\\\\build\\\\ ..\\\\plugins\\\\"},"dependencies":{"@qandq/cloud-gcs-core":"^1.2.13","@types/geojson":"^7946.0.8","@types/react":"^18.0.14","@types/urijs":"^1.19.19","antd":"4.23.5","axios":"^0.27.2","moment":"^2.29.3","querystring-es3":"^0.2.1","react":"^18.2.0","react-dom":"^18.2.0","style-loader":"^3.3.1","urijs":"^1.19.11","websocket-ts":"^1.1.1"},"devDependencies":{"@types/jest":"^28.1.1","css-loader":"^6.7.1","dotenv-webpack":"^7.1.1","html-loader":"^3.1.2","ts-jest":"^28.0.4","ts-loader":"^9.3.0","typescript":"^4.7.3","webpack":"^5.73.0","webpack-cli":"^4.9.2"},"browser":{"[module-name]":false}}')}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return n[e](r,r.exports,o),r.exports}var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.getAttributes=void 0;const t=o(893),r=o(745),n=o(423),s=o(147);e.getAttributes=()=>({name:s.name,libraryName:s.libraryName,version:s.version,config:s.config}),e.default=class{constructor(e){this.PluginApi=e}init(){(0,r.createRoot)(this.PluginApi.pluginUIManager.getRootElement()).render((0,t.jsx)(n.default,{pluginApi:this.PluginApi}))}}})(),i})()));